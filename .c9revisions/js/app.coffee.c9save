{"ts":1377444769358,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"# app startup.\r\ndefine [\"backbone\", \"marionette\", \"msgbus\", \"apps/load\" ], (Backbone, Marionette, msgBus ) ->\r\n    app = new Marionette.Application()\r\n\r\n    app.rootRoute = \"about\"\r\n\r\n    app.addRegions\r\n        headerRegion : \"#header-region\"\r\n        mainRegion : \"#main-region\"\r\n        footerRegion : \"#footer-region\"\r\n        jackRegion : \"#jack-region\"\r\n\r\n    app.on \"initialize:before\", (options={}) ->\r\n        console.log \"init:before\", options\r\n\r\n    msgBus.reqres.setHandler \"default:region\",->\r\n        app.mainRegion\r\n\r\n    msgBus.reqres.setHandler \"jack:region\",->\r\n        app.jackRegion\r\n\r\n    msgBus.reqres.setHandler \"header:region\", ->\r\n        app.headerRegion\r\n\r\n    msgBus.reqres.setHandler \"footer:region\", ->\r\n        app.footerRegion\r\n\r\n    msgBus.reqres.setHandler \"main:region\", ->\r\n        app.mainRegion\r\n\r\n    msgBus.commands.setHandler \"register:instance\", (instance, id) ->\r\n        app.register instance, id\r\n\r\n    msgBus.commands.setHandler \"unregister:instance\", (instance, id) ->\r\n        app.unregister instance, id\r\n\r\n\r\n\r\n    app.on \"initialize:after\", (options={})->\r\n        console.log \"init:after>>\"\r\n        appstate = msgBus.reqres.request \"get:current:appstate\"\r\n        # trigger a specific event when the loginStatus ever changes (to be handled by our header list controller to show/hide login UI\r\n        # appstate.on \"change:loginStatus\" (model, status)->\r\n        #    msgBus.events.trigger \"login:status:change\", status\r\n\r\n        if Backbone.history\r\n            Backbone.history.start()\r\n            frag = Backbone.history.fragment\r\n            match = /access_token/i.test frag  # hey jack I like this better than .indexOf ...\r\n            if match\r\n                appstate.set \"accessToken\",  frag.split(\"=\")[1]\r\n                appstate.set \"loginStatus\", true\r\n                @navigate(@rootRoute, trigger: true)             #Backbone.history.navigate @rootRoute, trigger:true\r\n\r\n            else\r\n\r\n                @navigate(@rootRoute, trigger: true) if @getCurrentRoute() is null             #Backbone.history.navigate @rootRoute, trigger:true\r\n\r\n    app.addInitializer (options) ->\r\n        console.log \"addinitializers\"\r\n        msgBus.commands.execute \"start:header:app\"\r\n        msgBus.commands.execute \"start:footer:app\"\r\n        msgBus.commands.execute \"start:d3:app\"\r\n        msgBus.commands.execute \"start:about:app\"\r\n        msgBus.commands.execute \"start:oauth:app\"\r\n\r\n\r\n\r\n    app"]],"start1":0,"start2":0,"length1":0,"length2":2454}]],"length":2454}
{"contributors":[],"silentsave":false,"ts":1377444822118,"patch":[[{"diffs":[[0,"h:app\"\r\n"],[1,"        msgBus.commands.execute \"start:top:app\"\r\n\r\n\r\n"],[0,"\r\n\r\n\r\n  "]],"start1":2433,"start2":2433,"length1":16,"length2":69}]],"length":2507,"saved":false}
{"ts":1377445095170,"patch":[[{"diffs":[[0,"\"about\"\r"],[1,"\n    app.authRoute = \"top\"\r"],[0,"\n\r\n    a"]],"start1":173,"start2":173,"length1":16,"length2":43}]],"length":2534,"saved":false}
{"ts":1377445107025,"patch":[[{"diffs":[[0,"     @navigate(@"],[-1,"root"],[1,"auth"],[0,"Route, trigger: "]],"start1":1859,"start2":1859,"length1":36,"length2":36}]],"length":2534,"saved":false}
{"ts":1377445288212,"patch":[[{"diffs":[[0," true\r\n "],[1,"               console.log \"top route\", @authRoute\r\n"],[0,"        "]],"start1":1841,"start2":1841,"length1":16,"length2":68}]],"length":2586,"saved":false}
{"ts":1377445306681,"patch":[[{"diffs":[[0,"\n               "],[1," "],[0,"@navigate(@authR"]],"start1":1900,"start2":1900,"length1":32,"length2":33}]],"length":2587,"saved":false}
{"ts":1377445393081,"patch":[[{"diffs":[[0,"   else\r"],[1,"\n                console.log \"else statement\"\r"],[0,"\n\r\n     "]],"start1":2030,"start2":2030,"length1":16,"length2":62}]],"length":2633,"saved":false}
{"ts":1377445515282,"patch":[[{"diffs":[[0," match\r\n"],[1,"                @navigate(@authRoute, trigger: true)             #Backbone.history.navigate @rootRoute, trigger:true\r\n"],[0,"        "]],"start1":1725,"start2":1725,"length1":16,"length2":134},{"diffs":[[0,"ute\r"],[-1,"\n                @navigate(@authRoute, trigger: true)             #Backbone.history.navigate @rootRoute, trigger:true\r"],[0,"\n\r\n "]],"start1":2014,"start2":2014,"length1":126,"length2":8}]],"length":2633,"saved":false}
